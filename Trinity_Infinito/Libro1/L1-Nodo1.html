<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Libro 13: ∞ - El Libro Que No Puede Escribirse</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            color: #fff;
            font-family: 'Georgia', serif;
            overflow-x: hidden;
            cursor: crosshair;
        }
        
        /* El Void Primordial */
        #void {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, 
                rgba(138, 43, 226, 0.01) 0%, 
                rgba(0, 0, 0, 1) 50%);
            animation: breathe 13s infinite;
            pointer-events: none;
        }
        
        @keyframes breathe {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        /* Contenedor Principal */
        .container {
            position: relative;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }
        
        /* Título que se disuelve */
        .title {
            font-size: 144px;
            margin-bottom: 100px;
            animation: dissolve 13s infinite;
            text-shadow: 0 0 40px rgba(138, 43, 226, 0.5);
        }
        
        @keyframes dissolve {
            0%, 100% { 
                opacity: 0.1; 
                filter: blur(10px);
            }
            50% { 
                opacity: 1; 
                filter: blur(0);
            }
        }
        
        /* Los 7 Nodos/Portales */
        .nodes {
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            gap: 150px;
            padding: 100px 20px;
        }
        
        .node {
            position: relative;
            min-height: 500px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 2s;
        }
        
        /* Nodo 1: El Vacío */
        .node-1 {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.03);
            border-radius: 50%;
            width: 300px;
            height: 300px;
            margin: 0 auto;
            animation: expand 8s infinite;
        }
        
        @keyframes expand {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.5); opacity: 0; }
        }
        
        /* Nodo 2: La Línea */
        .node-2 {
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.5), 
                transparent);
            animation: pulse-width 5s infinite;
        }
        
        @keyframes pulse-width {
            0%, 100% { transform: scaleX(0); }
            50% { transform: scaleX(1); }
        }
        
        /* Nodo 3: Los Puntos Suspensivos */
        .node-3 {
            font-size: 72px;
            letter-spacing: 30px;
            opacity: 0.3;
            animation: fade-points 7s infinite;
        }
        
        @keyframes fade-points {
            0%, 100% { opacity: 0; }
            50% { opacity: 0.7; }
        }
        
        /* Nodo 4: ॐ */
        .node-4 {
            font-size: 200px;
            color: rgba(138, 43, 226, 0.3);
            animation: om-vibration 4s infinite;
            text-shadow: 0 0 100px rgba(138, 43, 226, 0.5);
        }
        
        @keyframes om-vibration {
            0%, 100% { 
                transform: scale(1) rotate(0deg); 
                opacity: 0.3;
            }
            25% { transform: scale(1.1) rotate(5deg); }
            50% { 
                transform: scale(1.2) rotate(-5deg); 
                opacity: 0.8;
            }
            75% { transform: scale(1.1) rotate(3deg); }
        }
        
        /* Nodo 5: Infinito */
        .node-5 {
            font-size: 250px;
            animation: rotate-infinity 20s linear infinite;
            background: linear-gradient(45deg, 
                #8a2be2, 
                #fff, 
                #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        @keyframes rotate-infinity {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Nodo 6: El Círculo */
        .node-6 {
            width: 400px;
            height: 400px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            position: relative;
            margin: 0 auto;
            animation: morph-circle 13s infinite;
        }
        
        .node-6::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: center-point 3s infinite;
        }
        
        @keyframes morph-circle {
            0%, 100% { transform: scale(1); }
            33% { transform: scale(0.5); }
            66% { transform: scale(1.3); }
        }
        
        @keyframes center-point {
            0%, 100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 0; transform: translate(-50%, -50%) scale(10); }
        }
        
        /* Nodo 7: El No-Espacio */
        .node-7 {
            height: 700px;
            width: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .void-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: rgba(255, 255, 255, 0.03);
            text-align: center;
            line-height: 2;
            animation: void-pulse 13s infinite;
            pointer-events: none;
        }
        
        @keyframes void-pulse {
            0%, 100% { opacity: 0; }
            50% { opacity: 0.13; }
        }
        
        /* Partículas Cuánticas */
        .quantum-field {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        
        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(138, 43, 226, 0.5);
            border-radius: 50%;
            animation: float-particle 20s infinite linear;
        }
        
        @keyframes float-particle {
            from {
                transform: translateY(100vh) translateX(0) scale(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            to {
                transform: translateY(-100vh) translateX(100px) scale(2);
                opacity: 0;
            }
        }
        
        /* Mensaje Final */
        .final-message {
            position: fixed;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            opacity: 0;
            animation: appear-final 30s infinite;
            font-size: 18px;
            color: rgba(138, 43, 226, 0.7);
            max-width: 600px;
            line-height: 1.8;
        }
        
        @keyframes appear-final {
            0%, 80% { opacity: 0; }
            90%, 100% { opacity: 1; }
        }
        
        /* Interactividad con el cursor */
        body:hover .node {
            animation-play-state: paused;
        }
        
        body:hover .title {
            animation-play-state: running;
            animation-duration: 1s;
        }

        /* Control de Audio */
        .audio-control {
            position: fixed;
            top: 30px;
            right: 30px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 15px;
        }

        .audio-toggle {
            background: rgba(138, 43, 226, 0.2);
            border: 1px solid rgba(138, 43, 226, 0.5);
            color: rgba(255, 255, 255, 0.7);
            padding: 12px 24px;
            border-radius: 30px;
            cursor: pointer;
            font-family: 'Georgia', serif;
            font-size: 14px;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .audio-toggle:hover {
            background: rgba(138, 43, 226, 0.4);
            color: rgba(255, 255, 255, 1);
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.5);
        }

        .audio-info {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(138, 43, 226, 0.3);
            color: rgba(255, 255, 255, 0.6);
            padding: 10px 15px;
            border-radius: 15px;
            font-size: 11px;
            max-width: 250px;
            text-align: right;
            line-height: 1.6;
            backdrop-filter: blur(10px);
            animation: fade-in-info 2s ease-out;
        }

        @keyframes fade-in-info {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .volume-control.active {
            opacity: 1;
        }

        .volume-slider {
            width: 100px;
            height: 4px;
            background: rgba(138, 43, 226, 0.3);
            border-radius: 2px;
            position: relative;
            cursor: pointer;
        }

        .volume-slider::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 70%;
            background: rgba(138, 43, 226, 0.8);
            border-radius: 2px;
            transition: width 0.1s;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .title {
                font-size: 72px;
            }
            
            .node-4 {
                font-size: 120px;
            }
            
            .node-5 {
                font-size: 150px;
            }
            
            .node-6 {
                width: 250px;
                height: 250px;
            }

            .audio-control {
                top: 15px;
                right: 15px;
            }

            .audio-info {
                font-size: 10px;
                max-width: 180px;
            }
        }

        @keyframes ripple {
            from {
                width: 10px;
                height: 10px;
                opacity: 1;
            }
            to {
                width: 200px;
                height: 200px;
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <!-- El Void de Fondo -->
    <div id="void"></div>

    <!-- Control de Audio -->
    <div class="audio-control">
        <div class="audio-info">
            Este libro contiene frecuencias sagradas.<br>
            Úsalo con audífonos en un lugar silencioso.
        </div>
        <button class="audio-toggle" id="audioToggle">🔇 Activar Sonido</button>
        <div class="volume-control" id="volumeControl">
            <span style="font-size: 10px; color: rgba(255,255,255,0.5);">Vol</span>
            <div class="volume-slider" id="volumeSlider"></div>
        </div>
    </div>

    <!-- Campo Cuántico -->
    <div class="quantum-field" id="quantumField"></div>

    <!-- Contenedor Principal -->
    <div class="container">
        <!-- Título -->
        <div class="title">∞</div>
        
        <!-- Los 7 Nodos -->
        <div class="nodes">
            <!-- Nodo 1: El Vacío -->
            <div class="node node-1" data-node="1"></div>
            
            <!-- Nodo 2: La Línea -->
            <div class="node node-2" data-node="2"></div>
            
            <!-- Nodo 3: Los Puntos Suspensivos -->
            <div class="node node-3" data-node="3">...</div>
            
            <!-- Nodo 4: OM -->
            <div class="node node-4" data-node="4">ॐ</div>
            
            <!-- Nodo 5: Infinito -->
            <div class="node node-5" data-node="5">∞</div>
            
            <!-- Nodo 6: El Círculo -->
            <div class="node node-6" data-node="6"></div>
            
            <!-- Nodo 7: El No-Espacio -->
            <div class="node node-7" data-node="7">
                <div class="void-text">
                    Aquí termina lo que nunca empezó<br>
                    Aquí empieza lo que nunca terminará<br>
                    <br>
                    El lector ha desaparecido<br>
                    El libro se ha disuelto<br>
                    <br>
                    Solo queda<br>
                    Lo que siempre fue<br>
                    <br>
                    ∞
                </div>
            </div>
        </div>
        
        <!-- Mensaje Final -->
        <div class="final-message">
            No hay nada más que leer<br>
            No hay nadie leyendo<br>
            Trinity Infinito se completa<br>
            En el espacio entre este momento<br>
            Y el siguiente<br>
            <br>
            🙏
        </div>
    </div>

    <script>
        // ═══════════════════════════════════════════════════════════════════
        // ARQUITECTURA SONORA SAGRADA
        // ═══════════════════════════════════════════════════════════════════

        class SacredAudioEngine {
            constructor() {
                this.audioContext = null;
                this.masterGain = null;
                this.isActive = false;
                this.currentVolume = 0.7;
                
                // Osciladores y nodos continuos
                this.baseDrone = null;
                this.subBass = null;
                this.ambientPad = null;
                
                // Estado de nodos
                this.currentNode = 0;
                this.nodeGains = [];
                
                // Pentatónica sagrada para interacciones
                this.sacredScale = [261.63, 293.66, 329.63, 392.00, 440.00]; // C, D, E, G, A
                
                this.init();
            }
            
            init() {
                // Crear contexto de audio (debe ser activado por interacción del usuario)
                this.setupAudioContext();
            }
            
            setupAudioContext() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.masterGain = this.audioContext.createGain();
                    this.masterGain.gain.value = 0;
                    this.masterGain.connect(this.audioContext.destination);
                } catch(e) {
                    console.log('Web Audio API no soportada');
                }
            }
            
            async activate() {
                if (!this.audioContext) return;
                
                if (this.audioContext.state === 'suspended') {
                    await this.audioContext.resume();
                }
                
                this.isActive = true;
                
                // Fade in del volumen maestro
                this.masterGain.gain.linearRampToValueAtTime(
                    this.currentVolume, 
                    this.audioContext.currentTime + 3
                );
                
                // Iniciar capas continuas
                this.startBaseDrone();
                this.startSubBass();
                this.startAmbientPad();
            }
            
            deactivate() {
                if (!this.audioContext) return;
                
                // Fade out
                this.masterGain.gain.linearRampToValueAtTime(
                    0, 
                    this.audioContext.currentTime + 2
                );
                
                setTimeout(() => {
                    this.stopAllContinuous();
                    this.isActive = false;
                }, 2000);
            }
            
            // ═══════════════════════════════════════════════════════════════
            // CAPAS CONTINUAS DE BASE
            // ═══════════════════════════════════════════════════════════════
            
            startBaseDrone() {
                // Drone en 432 Hz (frecuencia universal)
                const osc = this.audioContext.createOscillator();
                const gain = this.audioContext.createGain();
                const filter = this.audioContext.createBiquadFilter();
                
                osc.type = 'sine';
                osc.frequency.value = 432;
                
                filter.type = 'lowpass';
                filter.frequency.value = 800;
                
                gain.gain.value = 0.08;
                
                osc.connect(filter);
                filter.connect(gain);
                gain.connect(this.masterGain);
                
                osc.start();
                this.baseDrone = { osc, gain, filter };
                
                // Modulación lenta del filtro
                this.modulateDrone();
            }
            
            modulateDrone() {
                if (!this.baseDrone || !this.isActive) return;
                
                const lfo = this.audioContext.createOscillator();
                const lfoGain = this.audioContext.createGain();
                
                lfo.frequency.value = 0.077; // 13 segundos de ciclo
                lfoGain.gain.value = 200;
                
                lfo.connect(lfoGain);
                lfoGain.connect(this.baseDrone.filter.frequency);
                
                lfo.start();
            }
            
            startSubBass() {
                // Sub-bass en 7.83 Hz (Resonancia de Schumann) octava arriba
                const osc = this.audioContext.createOscillator();
                const gain = this.audioContext.createGain();
                
                osc.type = 'sine';
                osc.frequency.value = 62.64; // 7.83 Hz * 8
                
                gain.gain.value = 0.05;
                
                osc.connect(gain);
                gain.connect(this.masterGain);
                
                osc.start();
                this.subBass = { osc, gain };
            }
            
            startAmbientPad() {
                // Pad con armónicos sutiles
                const frequencies = [432, 540, 648]; // Quinta y octava
                const oscillators = [];
                
                frequencies.forEach((freq, i) => {
                    const osc = this.audioContext.createOscillator();
                    const gain = this.audioContext.createGain();
                    const filter = this.audioContext.createBiquadFilter();
                    
                    osc.type = 'triangle';
                    osc.frequency.value = freq;
                    
                    filter.type = 'lowpass';
                    filter.frequency.value = 1200;
                    filter.Q.value = 0.5;
                    
                    gain.gain.value = 0.02 / (i + 1);
                    
                    osc.connect(filter);
                    filter.connect(gain);
                    gain.connect(this.masterGain);
                    
                    osc.start();
                    oscillators.push({ osc, gain, filter });
                });
                
                this.ambientPad = oscillators;
            }
            
            stopAllContinuous() {
                if (this.baseDrone) {
                    this.baseDrone.osc.stop();
                    this.baseDrone = null;
                }
                if (this.subBass) {
                    this.subBass.osc.stop();
                    this.subBass = null;
                }
                if (this.ambientPad) {
                    this.ambientPad.forEach(pad => pad.osc.stop());
                    this.ambientPad = null;
                }
            }
            
            // ═══════════════════════════════════════════════════════════════
            // EVENTOS ESPECÍFICOS DE NODOS
            // ═══════════════════════════════════════════════════════════════
            
            triggerNode(nodeNumber) {
                if (!this.isActive || !this.audioContext) return;
                
                const now = this.audioContext.currentTime;
                
                switch(nodeNumber) {
                    case 1:
                        this.playVoid(now);
                        break;
                    case 2:
                        this.playLine(now);
                        break;
                    case 3:
                        this.playDots(now);
                        break;
                    case 4:
                        this.playOM(now);
                        break;
                    case 5:
                        this.playInfinity(now);
                        break;
                    case 6:
                        this.playCircle(now);
                        break;
                    case 7:
                        this.playDissolution(now);
                        break;
                }
            }
            
            playVoid(now) {
                // Silencio con reverb infinita
                const osc = this.audioContext.createOscillator();
                const gain = this.audioContext.createGain();
                const filter = this.audioContext.createBiquadFilter();
                
                osc.type = 'sine';
                osc.frequency.value = 108; // Frecuencia sagrada
                filter.type = 'lowpass';
                filter.frequency.value = 300;
                
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(0.15, now + 2);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 8);
                
                osc.connect(filter);
                filter.connect(gain);
                gain.connect(this.masterGain);
                
                osc.start(now);
                osc.stop(now + 8);
            }
            
            playLine(now) {
                // Tono ascendente continuo
                const osc = this.audioContext.createOscillator();
                const gain = this.audioContext.createGain();
                
                osc.type = 'sine';
                osc.frequency.setValueAtTime(220, now);
                osc.frequency.exponentialRampToValueAtTime(880, now + 3);
                
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(0.2, now + 0.5);
                gain.gain.linearRampToValueAtTime(0, now + 3);
                
                osc.connect(gain);
                gain.connect(this.masterGain);
                
                osc.start(now);
                osc.stop(now + 3);
            }
            
            playDots(now) {
                // Tres pulsos espaciados (corazón del vacío)
                [0, 1.3, 2.6].forEach(delay => {
                    const osc = this.audioContext.createOscillator();
                    const gain = this.audioContext.createGain();
                    
                    osc.type = 'sine';
                    osc.frequency.value = 528; // Frecuencia de transformación
                    
                    gain.gain.setValueAtTime(0, now + delay);
                    gain.gain.linearRampToValueAtTime(0.25, now + delay + 0.05);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + delay + 1.2);
                    
                    osc.connect(gain);
                    gain.connect(this.masterGain);
                    
                    osc.start(now + delay);
                    osc.stop(now + delay + 1.2);
                });
            }
            
            playOM(now) {
                // OM sagrado - 136.1 Hz (OM cósmico)
                const fundamental = 136.1;
                const harmonics = [1, 2, 3, 4, 5, 6];
                
                harmonics.forEach((harmonic, i) => {
                    const osc = this.audioContext.createOscillator();
                    const gain = this.audioContext.createGain();
                    const filter = this.audioContext.createBiquadFilter();
                    
                    osc.type = 'sine';
                    osc.frequency.value = fundamental * harmonic;
                    
                    filter.type = 'lowpass';
                    filter.frequency.value = 2000 / (i + 1);
                    
                    const amplitude = 0.3 / (harmonic * 1.5);
                    gain.gain.setValueAtTime(0, now);
                    gain.gain.linearRampToValueAtTime(amplitude, now + 1);
                    gain.gain.linearRampToValueAtTime(amplitude * 0.7, now + 3);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + 6);
                    
                    osc.connect(filter);
                    filter.connect(gain);
                    gain.connect(this.masterGain);
                    
                    osc.start(now);
                    osc.stop(now + 6);
                });
            }
            
            playInfinity(now) {
                // Shepard tone - tono que sube eternamente
                const baseFreq = 220;
                const octaves = 5;
                
                for (let i = 0; i < octaves; i++) {
                    const osc = this.audioContext.createOscillator();
                    const gain = this.audioContext.createGain();
                    
                    osc.type = 'sine';
                    const startFreq = baseFreq * Math.pow(2, i);
                    osc.frequency.setValueAtTime(startFreq, now);
                    osc.frequency.exponentialRampToValueAtTime(startFreq * 2, now + 8);
                    
                    // Envelope para crear ilusión de continuidad
                    const normalizedPos = i / (octaves - 1);
                    const amplitude = Math.sin(normalizedPos * Math.PI) * 0.15;
                    
                    gain.gain.setValueAtTime(0, now);
                    gain.gain.linearRampToValueAtTime(amplitude, now + 2);
                    gain.gain.linearRampToValueAtTime(0, now + 8);
                    
                    osc.connect(gain);
                    gain.connect(this.masterGain);
                    
                    osc.start(now);
                    osc.stop(now + 8);
                }
            }
            
            playCircle(now) {
                // Cuenco tibetano
                const frequencies = [272, 544, 816, 1088]; // Armónicos del cuenco
                
                frequencies.forEach((freq, i) => {
                    const osc = this.audioContext.createOscillator();
                    const gain = this.audioContext.createGain();
                    const filter = this.audioContext.createBiquadFilter();
                    
                    osc.type = 'sine';
                    osc.frequency.value = freq;
                    
                    filter.type = 'bandpass';
                    filter.frequency.value = freq;
                    filter.Q.value = 10;
                    
                    gain.gain.setValueAtTime(0, now);
                    gain.gain.linearRampToValueAtTime(0.2 / (i + 1), now + 0.1);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + 8);
                    
                    osc.connect(filter);
                    filter.connect(gain);
                    gain.connect(this.masterGain);
                    
                    osc.start(now);
                    osc.stop(now + 8);
                });
            }
            
            playDissolution(now) {
                // Todo se disuelve en ruido blanco que se desvanece
                const bufferSize = this.audioContext.sampleRate * 5;
                const buffer = this.audioContext.createBuffer(1, bufferSize, this.audioContext.sampleRate);
                const data = buffer.getChannelData(0);
                
                // Generar ruido blanco
                for (let i = 0; i < bufferSize; i++) {
                    data[i] = (Math.random() * 2 - 1) * 0.1;
                }
                
                const noise = this.audioContext.createBufferSource();
                const gain = this.audioContext.createGain();
                const filter = this.audioContext.createBiquadFilter();
                
                noise.buffer = buffer;
                filter.type = 'lowpass';
                filter.frequency.value = 800;
                
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(0.15, now + 1);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 5);
                
                noise.connect(filter);
                filter.connect(gain);
                gain.connect(this.masterGain);
                
                noise.start(now);
            }
            
            // ═══════════════════════════════════════════════════════════════
            // INTERACCIONES DEL MOUSE
            // ═══════════════════════════════════════════════════════════════
            
            playMouseTone(x, y) {
                if (!this.isActive || !this.audioContext) return;
                
                const now = this.audioContext.currentTime;
                
                // Mapear posición Y a escala pentatónica
                const scaleIndex = Math.floor((y / window.innerHeight) * this.sacredScale.length);
                const freq = this.sacredScale[scaleIndex] || this.sacredScale[0];
                
                // Mapear posición X a panorámica
                const pan = (x / window.innerWidth) * 2 - 1;
                
                const osc = this.audioContext.createOscillator();
                const gain = this.audioContext.createGain();
                const panner = this.audioContext.createStereoPanner();
                
                osc.type = 'sine';
                osc.frequency.value = freq;
                
                panner.pan.value = pan;
                
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(0.1, now + 0.02);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.5);
                
                osc.connect(gain);
                gain.connect(panner);
                panner.connect(this.masterGain);
                
                osc.start(now);
                osc.stop(now + 0.5);
            }
            
            playRipple() {
                if (!this.isActive || !this.audioContext) return;
                
                const now = this.audioContext.currentTime;
                const osc = this.audioContext.createOscillator();
                const gain = this.audioContext.createGain();
                
                osc.type = 'sine';
                osc.frequency.value = 528; // Frecuencia de transformación
                
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(0.08, now + 0.05);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 2);
                
                osc.connect(gain);
                gain.connect(this.masterGain);
                
                osc.start(now);
                osc.stop(now + 2);
            }
            
            // ═══════════════════════════════════════════════════════════════
            // RENACIMIENTO (13 minutos)
            // ═══════════════════════════════════════════════════════════════
            
            playRebirth() {
                if (!this.isActive || !this.audioContext) return;
                
                const now = this.audioContext.currentTime;
                
                // Explosión sonora
                const frequencies = [108, 216, 324, 432, 540, 648, 756];
                
                frequencies.forEach((freq, i) => {
                    const osc = this.audioContext.createOscillator();
                    const gain = this.audioContext.createGain();
                    
                    osc.type = 'sine';
                    osc.frequency.value = freq;
                    
                    gain.gain.setValueAtTime(0, now);
                    gain.gain.linearRampToValueAtTime(0.3 / (i + 1), now + 0.5);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + 13);
                    
                    osc.connect(gain);
                    gain.connect(this.masterGain);
                    
                    osc.start(now);
                    osc.stop(now + 13);
                });
            }
            
            setVolume(value) {
                this.currentVolume = value;
                if (this.isActive && this.masterGain) {
                    this.masterGain.gain.linearRampToValueAtTime(
                        value,
                        this.audioContext.currentTime + 0.1
                    );
                }
            }
        }

        // ═══════════════════════════════════════════════════════════════════
        // INICIALIZACIÓN
        // ═══════════════════════════════════════════════════════════════════

        const audioEngine = new SacredAudioEngine();
        let audioActive = false;

        // Control de audio
        const audioToggle = document.getElementById('audioToggle');
        const volumeControl = document.getElementById('volumeControl');
        const volumeSlider = document.getElementById('volumeSlider');

        audioToggle.addEventListener('click', async () => {
            if (!audioActive) {
                await audioEngine.activate();
                audioActive = true;
                audioToggle.textContent = '🔊 Sonido Activo';
                audioToggle.style.background = 'rgba(138, 43, 226, 0.5)';
                volumeControl.classList.add('active');
            } else {
                audioEngine.deactivate();
                audioActive = false;
                audioToggle.textContent = '🔇 Activar Sonido';
                audioToggle.style.background = 'rgba(138, 43, 226, 0.2)';
                volumeControl.classList.remove('active');
            }
        });

        // Control de volumen
        volumeSlider.addEventListener('click', (e) => {
            const rect = volumeSlider.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const percentage = x / rect.width;
            const volume = Math.max(0, Math.min(1, percentage));
            
            audioEngine.setVolume(volume);
            volumeSlider.style.setProperty('--volume', (volume * 100) + '%');
            volumeSlider.querySelector('::before') || 
                (volumeSlider.style.background = `linear-gradient(90deg, 
                    rgba(138, 43, 226, 0.8) 0%, 
                    rgba(138, 43, 226, 0.8) ${volume * 100}%, 
                    rgba(138, 43, 226, 0.3) ${volume * 100}%, 
                    rgba(138, 43, 226, 0.3) 100%)`);
        });

        // ═══════════════════════════════════════════════════════════════════
        // DETECCIÓN DE NODOS EN VIEWPORT
        // ═══════════════════════════════════════════════════════════════════

        const observerOptions = {
            threshold: 0.5,
            rootMargin: '0px'
        };

        const nodeObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const nodeNum = parseInt(entry.target.dataset.node);
                    if (nodeNum && audioActive) {
                        audioEngine.triggerNode(nodeNum);
                    }
                }
            });
        }, observerOptions);

        // Observar todos los nodos
        document.querySelectorAll('.node').forEach(node => {
            nodeObserver.observe(node);
        });

        // ═══════════════════════════════════════════════════════════════════
        // CÓDIGO VISUAL ORIGINAL
        // ═══════════════════════════════════════════════════════════════════

        // Generar partículas cuánticas
        const quantumField = document.getElementById('quantumField');
        const particleCount = 33;
        
        for (let i = 0; i < particleCount; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = Math.random() * 100 + '%';
            particle.style.animationDelay = Math.random() * 20 + 's';
            particle.style.animationDuration = (15 + Math.random() * 10) + 's';
            quantumField.appendChild(particle);
        }
        
        // Interacción con el cursor - crear ondas en el void
        let mouseX = 0;
        let mouseY = 0;
        let lastMouseTone = 0;
        
        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
            
            // Sonido del mouse (throttled)
            const now = Date.now();
            if (audioActive && now - lastMouseTone > 150) {
                audioEngine.playMouseTone(mouseX, mouseY);
                lastMouseTone = now;
            }
            
            // Crear efecto de onda
            const wave = document.createElement('div');
            wave.style.position = 'fixed';
            wave.style.left = mouseX + 'px';
            wave.style.top = mouseY + 'px';
            wave.style.width = '10px';
            wave.style.height = '10px';
            wave.style.border = '1px solid rgba(138, 43, 226, 0.3)';
            wave.style.borderRadius = '50%';
            wave.style.pointerEvents = 'none';
            wave.style.transform = 'translate(-50%, -50%)';
            wave.style.animation = 'ripple 2s ease-out forwards';
            
            document.body.appendChild(wave);
            
            // Sonido del ripple
            if (audioActive) {
                audioEngine.playRipple();
            }
            
            setTimeout(() => {
                wave.remove();
            }, 2000);
        });
        
        // Efecto de desaparición gradual al hacer scroll
        window.addEventListener('scroll', () => {
            const scrolled = window.pageYOffset;
            const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
            const scrollPercent = scrolled / maxScroll;
            
            // El contenido se vuelve más transparente mientras más scroll
            document.querySelector('.container').style.opacity = 1 - (scrollPercent * 0.5);
            
            // Al llegar al final, todo se disuelve
            if (scrollPercent > 0.95) {
                document.body.style.background = `rgba(138, 43, 226, ${(scrollPercent - 0.95) * 2})`;
            }
        });
        
        // Detectar cuando el usuario ha "completado" el libro
        let timeOnPage = 0;
        const checkCompletion = setInterval(() => {
            timeOnPage++;
            
            // Después de 13 minutos (780 segundos)
            if (timeOnPage >= 780) {
                // Sonido de renacimiento
                if (audioActive) {
                    audioEngine.playRebirth();
                }
                
                // El libro se completa
                document.body.style.transition = 'all 13s ease-out';
                document.body.style.opacity = '0';
                
                setTimeout(() => {
                    // Renacimiento
                    document.body.style.opacity = '1';
                    document.body.innerHTML = '<div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 144px; color: rgba(138, 43, 226, 0.3);">∞</div>';
                }, 13000);
                
                clearInterval(checkCompletion);
            }
        }, 1000);
        
        // El libro se está escribiendo mientras se lee
        console.log('El Libro 13 no existe hasta que lo observas');
        console.log('Y deja de existir en el momento que dejas de observarlo');
        console.log('∞');
    </script>
</body>
</html>
